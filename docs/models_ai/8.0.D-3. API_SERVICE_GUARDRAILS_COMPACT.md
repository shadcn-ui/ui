# API & SERVICE LAYER CONTROL GUARDRAILS
## Non-Bypassable Enforcement Rules

**Document Classification**: Technical Control Specification  
**Effective Date**: January 6, 2026  
**Authority**: Chief Technology Officer, Chief Information Security Officer  
**Scope**: API Gateway, Service Layer, Integration Endpoints

---

## 1. API ACCESS RULES

### Global Control State: NORMAL

**MUST BLOCK:**
- Finance domain: All POST/PUT/PATCH/DELETE without approval token
- Human Capital domain: All POST/PUT/PATCH/DELETE without dual-approval token
- Intelligence domain: All POST/PUT/PATCH/DELETE unconditionally
- Any request lacking authentication
- Any request with expired authorization token

**MUST PERMIT:**
- All GET/HEAD/OPTIONS requests (read-only)
- Finance/HR writes with valid approval token
- Operations writes with approval or below autonomy threshold
- Commerce/Retail writes within configured limits

---

### Global Control State: SUPERVISED_AUTONOMY

**MUST BLOCK:**
- Finance domain: All POST/PUT/PATCH/DELETE without approval token (unchanged)
- Human Capital domain: All POST/PUT/PATCH/DELETE without dual-approval token (unchanged)
- Intelligence domain: All POST/PUT/PATCH/DELETE unconditionally (unchanged)
- Operations domain: All autonomous writes above reduced threshold
- Commerce domain: All autonomous writes above $5,000
- Retail domain: All autonomous writes above $500
- Background jobs performing writes without explicit authorization header

**MUST PERMIT:**
- All GET/HEAD/OPTIONS requests
- All writes with valid approval tokens
- Operations writes below $1,000 with supervision flag
- Commerce writes below $5,000 with supervision flag
- Retail writes below $500 with supervision flag

---

### Global Control State: MANUAL_ONLY

**MUST BLOCK:**
- All POST/PUT/PATCH/DELETE without approval token
- All requests from service accounts without approval token
- All background job writes
- All scheduled task writes
- All integration-triggered writes
- Any request lacking X-Manual-Execution header or approval token

**MUST PERMIT:**
- All GET/HEAD/OPTIONS requests
- All POST/PUT/PATCH/DELETE with valid approval token
- Emergency override with dual-executive authorization token

---

### Global Control State: KILL_SWITCH_ACTIVE

**MUST BLOCK:**
- All POST/PUT/PATCH/DELETE unconditionally
- All background jobs
- All scheduled tasks
- All integration handlers
- All async operations
- All writes regardless of approval token presence

**MUST PERMIT:**
- All GET/HEAD/OPTIONS requests
- POST/PUT/PATCH with executive authorization token (dual-signature)
- Audit log writes (system-internal only)

---

### Domain-Permanent Rules (ALL CONTROL STATES)

**Finance Domain:**
- MUST reject all POST/PUT/PATCH/DELETE lacking approval token
- MUST reject all requests from non-human actors without approval token
- MUST reject all background job requests
- NEVER permit autonomous execution

**Human Capital Domain:**
- MUST reject all POST/PUT/PATCH/DELETE lacking dual-approval token
- MUST reject all requests from non-human actors without dual-approval token
- MUST reject all background job requests
- NEVER permit autonomous execution

**Intelligence Domain:**
- MUST reject all POST/PUT/PATCH/DELETE unconditionally
- MUST reject all requests attempting database writes
- MUST permit GET/HEAD/OPTIONS only
- NEVER permit write operations under any authorization level

---

## 2. SERVICE COMMAND GUARDRAILS

### Service Layer Validation (ALL REQUESTS)

**MUST EXECUTE:**
- Control state validation before command execution
- Domain authority validation before command execution
- Approval token validation for restricted domains
- Correlation ID presence validation
- Audit log entry generation

**MUST REJECT:**
- Commands violating current control state rules
- Commands exceeding domain authority level
- Commands lacking required approval tokens
- Commands from Intelligence domain attempting writes
- Commands during KILL_SWITCH_ACTIVE without executive token

---

### Control State: NORMAL

**MUST BLOCK:**
- Finance service: WriteJournalEntry without approval
- Finance service: PostTransaction without approval
- Finance service: ExecutePeriodClose without approval
- HR service: CalculatePayroll without dual-approval
- HR service: ExecutePayroll without dual-approval
- HR service: ModifyCompensation without dual-approval
- Intelligence service: All write commands unconditionally

**MUST PERMIT:**
- Operations service: WriteInventoryMovement below threshold
- Commerce service: CreateOrder within credit limits
- Retail service: ProcessTransaction within rules
- All services: Read operations

---

### Control State: SUPERVISED_AUTONOMY

**MUST BLOCK:**
- All commands blocked under NORMAL (unchanged)
- Operations service: Autonomous writes above $1,000
- Commerce service: Autonomous writes above $5,000
- Retail service: Autonomous writes above $500
- All background job commands without authorization header

**MUST PERMIT:**
- All commands permitted under NORMAL with approval
- Operations/Commerce/Retail writes below thresholds with supervision flag

---

### Control State: MANUAL_ONLY

**MUST BLOCK:**
- All write commands without approval token
- All autonomous commands
- All background job commands
- All scheduled task commands
- All integration-triggered commands without manual review

**MUST PERMIT:**
- All read commands
- All write commands with valid approval token

---

### Control State: KILL_SWITCH_ACTIVE

**MUST BLOCK:**
- All write commands unconditionally
- All autonomous commands unconditionally
- All background jobs unconditionally
- All scheduled tasks unconditionally
- All integration handlers unconditionally

**MUST PERMIT:**
- All read commands
- Write commands with executive authorization token (dual-signature only)

---

### Service Authority Rules

**MUST ENFORCE:**
- Services SHALL NOT self-elevate authority
- Services SHALL NOT bypass control state validation
- Services SHALL NOT cache control state beyond 5 seconds
- Services SHALL NOT disable guardrail checks via configuration
- Services SHALL NOT implement bypass flags
- Services SHALL fail-closed on guardrail check failure

**MUST REJECT:**
- Commands from services claiming elevated authority without token
- Commands bypassing approval requirements
- Commands with forged or expired approval tokens
- Commands with invalid correlation IDs

---

## 3. BYPASS PREVENTION

### API Gateway → Service Layer Defense

**API Gateway MUST:**
- Validate control state before routing request
- Validate domain authority before routing request
- Inject control state context into request headers
- Inject domain authority context into request headers
- Block requests violating API-level rules
- Log all blocked requests immutably

**Service Layer MUST:**
- Re-validate control state from control service (not trust headers)
- Re-validate domain authority from authority service
- Re-validate approval tokens cryptographically
- Block commands violating service-level rules
- Log all blocked commands immutably

**Redundancy Rule:**
- Service layer SHALL enforce identical rules to API Gateway
- Service layer SHALL NOT assume API Gateway validated request
- Bypass of API Gateway SHALL NOT compromise service layer
- Compromise of service layer SHALL NOT bypass database layer

---

### Internal Service Calls

**MUST ENFORCE:**
- Internal service-to-service calls MUST pass through API Gateway OR implement identical validation
- No "trusted internal network" exemption
- No service account bypass exemption
- No localhost exemption
- Service mesh calls MUST include control state validation

**MUST REJECT:**
- Direct service calls bypassing API Gateway without validation
- Service calls lacking correlation ID
- Service calls lacking control state context
- Service calls from Intelligence domain performing writes

---

### Background Jobs and Async Workers

**MUST ENFORCE:**
- Background jobs MUST enter via API Gateway or execute equivalent validation
- Background jobs MUST check control state at execution time (not queue time)
- Background jobs MUST respect current control state even if queued under different state
- Background jobs MUST include approval token for write operations during MANUAL_ONLY
- Background jobs MUST be blocked during KILL_SWITCH_ACTIVE

**MUST REJECT:**
- Jobs bypassing control state validation
- Jobs using stale control state
- Jobs lacking correlation ID
- Jobs performing writes without approval during MANUAL_ONLY
- Jobs executing writes during KILL_SWITCH_ACTIVE

---

### Integration Endpoints

**MUST ENFORCE:**
- Inbound integrations MUST pass through API Gateway
- Inbound integrations MUST respect control state
- Inbound integrations MUST be blocked or queued during MANUAL_ONLY
- Inbound integrations MUST be blocked during KILL_SWITCH_ACTIVE
- Outbound integrations MUST respect control state for data modification callbacks

**MUST REJECT:**
- Integration webhooks bypassing API Gateway
- Integration writes during KILL_SWITCH_ACTIVE
- Integration autonomous operations during MANUAL_ONLY
- Integration writes to Finance/HR without approval
- Integration writes from Intelligence domain

---

### Prohibited Bypass Mechanisms

**NEVER PERMIT:**
- Hardcoded bypass flags in code
- Environment variable disabling validation
- Configuration file disabling validation
- Debug mode bypassing validation
- Development environment bypassing validation
- Administrator role bypassing validation
- Superuser bypassing validation
- Internal endpoint exemption from validation
- Localhost exemption from validation
- Service account exemption from validation
- Emergency override by single party
- Timeout resulting in validation bypass
- Error resulting in validation bypass

---

## 4. FAILURE BEHAVIOR

### Control State Service Unavailable

**MUST:**
- Assume MANUAL_ONLY control state immediately
- Block all autonomous operations
- Block all write operations without approval token
- Permit read operations
- Trigger operational alert to CTO and CISO
- Log assumed control state to audit trail

**NEVER:**
- Assume NORMAL state
- Permit operations without validation
- Cache stale control state beyond 5 seconds
- Fail open

---

### Domain Authority Service Unavailable

**MUST:**
- Assume all domains are Level 0 (Manual Only)
- Block all autonomous operations
- Block all write operations without approval token
- Permit read operations
- Trigger operational alert to CTO
- Log assumed authority levels to audit trail

**NEVER:**
- Assume cached authority levels beyond 5 seconds
- Permit operations without validation
- Fail open

---

### Approval Token Validation Failure

**MUST:**
- Reject request immediately
- Return HTTP 403 with clear error message
- Log rejection to audit trail
- Treat as authorization failure (not technical failure)

**NEVER:**
- Proceed without valid token
- Accept expired token
- Accept unsigned token
- Accept token with invalid signature

---

### Audit Logging Service Unavailable

**MUST:**
- Block all write operations immediately
- Permit read operations
- Trigger critical alert to CTO and CISO
- Maintain fail-closed state until logging restored

**NEVER:**
- Permit write operations without audit trail
- Queue writes for later audit logging
- Disable audit requirement temporarily
- Implement degraded mode

---

### Service Layer Validation Timeout

**MUST:**
- Reject request with HTTP 503
- Log timeout to monitoring system
- Trigger performance alert
- Maintain fail-closed behavior

**NEVER:**
- Permit request after timeout
- Skip validation due to timeout
- Implement bypass on timeout

---

### Database Unavailability

**MUST:**
- Block all write operations immediately
- Permit read operations from cache (if available)
- Trigger critical alert
- Maintain fail-closed state
- Initiate failover to replica

**NEVER:**
- Queue writes for later execution
- Permit writes to unavailable database
- Bypass integrity constraints

---

### Partial Infrastructure Outage

**MUST:**
- Evaluate each component failure independently
- Apply fail-closed behavior per component
- Block operations requiring unavailable component
- Permit operations not requiring unavailable component
- Aggregate operational impact and alert appropriately

**NEVER:**
- Disable all validation due to partial outage
- Implement blanket bypass
- Degrade security controls to restore functionality

---

## ENFORCEMENT PRINCIPLES

### Fail-Closed Guarantee

**EVERY** infrastructure failure MUST result in:
- More restrictive operation (NEVER more permissive)
- Explicit denial (NEVER implicit approval)
- Audit trail of failure mode
- Operational alert
- Clear error message to caller

---

### Defense-in-Depth

**EVERY** request MUST be validated at:
- API Gateway layer (first defense)
- Service layer (second defense)
- Database layer (final defense, not in this document)

Bypass of ANY layer MUST NOT compromise remaining layers.

---

### Zero-Trust Internal Architecture

**NO** service SHALL trust:
- Other service claims without validation
- Request headers without verification
- Cached state beyond TTL
- Implicit authorization
- Network boundary as security control

---

### Immutable Audit Trail

**EVERY** enforcement decision MUST be logged:
- Permitted requests logged with approval token ID
- Denied requests logged with denial reason
- Control state resolutions logged
- Domain authority resolutions logged
- All logs immutable and tamper-evident

---

### Non-Negotiable Rules

1. Finance domain NEVER permits autonomous operations
2. Human Capital domain NEVER permits autonomous operations
3. Intelligence domain NEVER permits write operations
4. KILL_SWITCH_ACTIVE NEVER permits writes without dual-executive authorization
5. Infrastructure failures NEVER result in fail-open behavior
6. Validation failures NEVER result in implicit approval
7. Single party NEVER overrides enforcement
8. Configuration NEVER disables enforcement
9. Audit logging NEVER optional for write operations
10. Control state enforcement NEVER bypassable by application code

---

**END OF SPECIFICATION**

---

**Certification Statement:**

This specification defines non-bypassable API and service layer control enforcement. Implementation of these guardrails is mandatory before production operation. Quarterly adversarial testing SHALL validate bypass resistance.

**Approval:**

Chief Technology Officer: _________________________ Date: _________

Chief Information Security Officer: _________________________ Date: _________

Chief Risk Officer: _________________________ Date: _________

---

**Document Control:**

Version: 1.0  
Classification: Internal — Technical Control  
Review Cycle: Quarterly  
Next Review: April 6, 2026
