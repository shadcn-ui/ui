{
  "name": "multi-select",
  "dependencies": [
    "@radix-ui/react-icons",
    "@radix-ui/react-popover",
    "@radix-ui/react-primitive",
    "@radix-ui/react-use-controllable-state"
  ],
  "files": [
    {
      "name": "multi-select.tsx",
      "content": "\"use client\"\n\nimport React from \"react\"\nimport { CaretSortIcon, CheckIcon, Cross2Icon } from \"@radix-ui/react-icons\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\nimport {\n  Primitive,\n  type ComponentPropsWithoutRef,\n} from \"@radix-ui/react-primitive\"\nimport { useControllableState } from \"@radix-ui/react-use-controllable-state\"\nimport { createPortal } from \"react-dom\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Badge } from \"@/registry/new-york/ui/badge\"\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n  CommandSeparator,\n} from \"@/registry/new-york/ui/command\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/registry/new-york/ui/tooltip\"\n\nexport interface MultiSelectOptionItem {\n  value: string\n  label?: React.ReactNode\n}\n\ninterface MultiSelectContextValue {\n  value: string[]\n\n  open: boolean\n\n  onSelect(value: string, item: MultiSelectOptionItem): void\n\n  onDeselect(value: string, item: MultiSelectOptionItem): void\n\n  onSearch?(keyword: string | undefined): void\n\n  filter?: boolean | ((keyword: string, current: string) => boolean)\n\n  disabled?: boolean\n\n  maxCount?: number\n\n  itemCache: Map<string, MultiSelectOptionItem>\n}\n\nconst MultiSelectContext = React.createContext<\n  MultiSelectContextValue | undefined\n>(undefined)\n\nconst useMultiSelect = () => {\n  const context = React.useContext(MultiSelectContext)\n\n  if (!context) {\n    throw new Error(\"useMultiSelect must be used within MultiSelectProvider\")\n  }\n\n  return context\n}\n\ntype MultiSelectProps = React.ComponentPropsWithoutRef<\n  typeof PopoverPrimitive.Root\n> & {\n  value?: string[]\n  onValueChange?(value: string[], items: MultiSelectOptionItem[]): void\n  onSelect?(value: string, item: MultiSelectOptionItem): void\n  onDeselect?(value: string, item: MultiSelectOptionItem): void\n  defaultValue?: string[]\n  onSearch?(keyword: string | undefined): void\n  filter?: boolean | ((keyword: string, current: string) => boolean)\n  disabled?: boolean\n  maxCount?: number\n}\n\nconst MultiSelect: React.FC<MultiSelectProps> = ({\n  value: valueProp,\n  onValueChange: onValueChangeProp,\n  onDeselect: onDeselectProp,\n  onSelect: onSelectProp,\n  defaultValue,\n  open: openProp,\n  onOpenChange,\n  defaultOpen,\n  onSearch,\n  filter,\n  disabled,\n  maxCount,\n  ...popoverProps\n}) => {\n  const itemCache = React.useRef(\n    new Map<string, MultiSelectOptionItem>()\n  ).current\n\n  const handleValueChange = React.useCallback(\n    (state: string[]) => {\n      if (onValueChangeProp) {\n        const items = state.map((value) => itemCache.get(value)!)\n\n        onValueChangeProp(state, items)\n      }\n    },\n    [onValueChangeProp]\n  )\n\n  const [value, setValue] = useControllableState({\n    prop: valueProp,\n    defaultProp: defaultValue,\n    onChange: handleValueChange,\n  })\n\n  const [open, setOpen] = useControllableState({\n    prop: openProp,\n    defaultProp: defaultOpen,\n    onChange: onOpenChange,\n  })\n\n  const handleSelect = React.useCallback(\n    (value: string, item: MultiSelectOptionItem) => {\n      setValue((prev) => {\n        if (prev?.includes(value)) {\n          return prev\n        }\n\n        onSelectProp?.(value, item)\n\n        return prev ? [...prev, value] : [value]\n      })\n    },\n    [onSelectProp, setValue]\n  )\n\n  const handleDeselect = React.useCallback(\n    (value: string, item: MultiSelectOptionItem) => {\n      setValue((prev) => {\n        if (!prev || !prev.includes(value)) {\n          return prev\n        }\n\n        onDeselectProp?.(value, item)\n\n        return prev.filter((v) => v !== value)\n      })\n    },\n    [onDeselectProp, setValue]\n  )\n\n  const contextValue = React.useMemo(() => {\n    return {\n      value: value || [],\n      open: open || false,\n      onSearch,\n      filter,\n      disabled,\n      maxCount,\n      onSelect: handleSelect,\n      onDeselect: handleDeselect,\n      itemCache,\n    }\n  }, [\n    value,\n    open,\n    onSearch,\n    filter,\n    disabled,\n    maxCount,\n    handleSelect,\n    handleDeselect,\n  ])\n\n  return (\n    <MultiSelectContext.Provider value={contextValue}>\n      <PopoverPrimitive.Root\n        {...popoverProps}\n        open={open}\n        onOpenChange={setOpen}\n      />\n    </MultiSelectContext.Provider>\n  )\n}\n\nMultiSelect.displayName = \"MultiSelect\"\n\ntype MultiSelectTriggerElement = React.ElementRef<typeof Primitive.div>\n\ninterface MultiSelectTriggerProps\n  extends ComponentPropsWithoutRef<typeof Primitive.div> {}\n\nconst PreventClick = (e: React.MouseEvent | React.TouchEvent) => {\n  e.preventDefault()\n  e.stopPropagation()\n}\n\nconst MultiSelectTrigger = React.forwardRef<\n  MultiSelectTriggerElement,\n  MultiSelectTriggerProps\n>(({ className, children, ...props }, forwardedRef) => {\n  const { disabled, itemCache } = useMultiSelect()\n\n  return (\n    <PopoverPrimitive.Trigger ref={forwardedRef as any} asChild>\n      <div\n        aria-disabled={disabled}\n        data-disabled={disabled}\n        {...props}\n        className={cn(\n          \"flex h-full min-h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background focus:outline-none focus:ring-1 focus:ring-ring [&>span]:line-clamp-1\",\n          disabled ? \"cursor-not-allowed opacity-50\" : \"cursor-text\",\n          className\n        )}\n        onClick={disabled ? PreventClick : props.onClick}\n        onTouchStart={disabled ? PreventClick : props.onTouchStart}\n      >\n        {children}\n        <CaretSortIcon aria-hidden className=\"h-4 w-4 opacity-50 shrink-0\" />\n      </div>\n    </PopoverPrimitive.Trigger>\n  )\n})\n\nMultiSelectTrigger.displayName = \"MultiSelectTrigger\"\n\ninterface MultiSelectValueProps\n  extends ComponentPropsWithoutRef<typeof Primitive.div> {\n  placeholder?: string\n  maxDisplay?: number\n  maxItemLength?: number\n}\n\nconst MultiSelectValue = React.forwardRef<\n  React.ElementRef<typeof Primitive.div>,\n  MultiSelectValueProps\n>(\n  (\n    { className, placeholder, maxDisplay, maxItemLength, ...props },\n    forwardRef\n  ) => {\n    const { value, itemCache, onDeselect } = useMultiSelect()\n    const [firstRendered, setFirstRendered] = React.useState(false)\n\n    const renderRemain =\n      maxDisplay && value.length > maxDisplay ? value.length - maxDisplay : 0\n    const renderItems = renderRemain ? value.slice(0, maxDisplay) : value\n\n    React.useLayoutEffect(() => {\n      setFirstRendered(true)\n    }, [])\n\n    if (!value.length || !firstRendered) {\n      return (\n        <span className=\"pointer-events-none text-muted-foreground\">\n          {placeholder}\n        </span>\n      )\n    }\n\n    return (\n      <TooltipProvider delayDuration={300}>\n        <div\n          className={cn(\n            \"flex flex-1 overflow-x-hidden flex-wrap items-center gap-1.5\",\n            className\n          )}\n          {...props}\n          ref={forwardRef}\n        >\n          {renderItems.map((value) => {\n            const item = itemCache.get(value)\n\n            const content = item?.label || value\n\n            const child =\n              maxItemLength &&\n              typeof content === \"string\" &&\n              content.length > maxItemLength\n                ? `${content.slice(0, maxItemLength)}...`\n                : content\n\n            const el = (\n              <Badge\n                variant=\"outline\"\n                key={value}\n                className=\"px-2 py-0 leading-4 pr-1 group/multi-select-badge cursor-pointer rounded-full\"\n                onClick={(e) => {\n                  e.preventDefault()\n                  e.stopPropagation()\n                  onDeselect(value, item!)\n                }}\n              >\n                <span>{child}</span>\n                <Cross2Icon className=\"h-3 w-3 ml-1 text-muted-foreground group-hover/multi-select-badge:text-foreground\" />\n              </Badge>\n            )\n\n            if (child !== content) {\n              return (\n                <Tooltip key={value}>\n                  <TooltipTrigger className=\"inline-flex\">{el}</TooltipTrigger>\n                  <TooltipContent\n                    side=\"bottom\"\n                    align=\"start\"\n                    className=\"z-[51]\"\n                  >\n                    {content}\n                  </TooltipContent>\n                </Tooltip>\n              )\n            }\n\n            return el\n          })}\n          {renderRemain ? (\n            <span className=\"text-muted-foreground text-xs leading-4 py-.5\">\n              +{renderRemain}\n            </span>\n          ) : null}\n        </div>\n      </TooltipProvider>\n    )\n  }\n)\n\nconst MultiSelectSearch = React.forwardRef<\n  React.ElementRef<typeof CommandInput>,\n  ComponentPropsWithoutRef<typeof CommandInput>\n>((props, ref) => {\n  const { onSearch } = useMultiSelect()\n\n  return <CommandInput ref={ref} {...props} onValueChange={onSearch} />\n})\n\nMultiSelectSearch.displayName = \"MultiSelectSearch\"\n\nconst MultiSelectList = React.forwardRef<\n  React.ElementRef<typeof CommandList>,\n  ComponentPropsWithoutRef<typeof CommandList>\n>(({ className, ...props }, ref) => {\n  return (\n    <CommandList\n      ref={ref}\n      className={cn(\"py-1 px-0 max-h-[unset]\", className)}\n      {...props}\n    />\n  )\n})\n\nMultiSelectList.displayName = \"MultiSelectList\"\n\ninterface MultiSelectContentProps\n  extends ComponentPropsWithoutRef<typeof PopoverPrimitive.Content> {}\n\nconst MultiSelectContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  MultiSelectContentProps\n>(({ className, children, ...props }, ref) => {\n  const context = useMultiSelect()\n\n  const fragmentRef = React.useRef<DocumentFragment>()\n\n  if (!fragmentRef.current && typeof window !== \"undefined\") {\n    fragmentRef.current = document.createDocumentFragment()\n  }\n\n  if (!context.open) {\n    return fragmentRef.current\n      ? createPortal(<Command>{children}</Command>, fragmentRef.current)\n      : null\n  }\n\n  return (\n    <PopoverPrimitive.Portal forceMount>\n      <PopoverPrimitive.Content\n        ref={ref}\n        align=\"start\"\n        sideOffset={4}\n        collisionPadding={10}\n        className={cn(\n          \"z-50 w-full rounded-md border bg-popover p-0 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\"\n        )}\n        style={\n          {\n            \"--radix-select-content-transform-origin\":\n              \"var(--radix-popper-transform-origin)\",\n            \"--radix-select-content-available-width\":\n              \"var(--radix-popper-available-width)\",\n            \"--radix-select-content-available-height\":\n              \"var(--radix-popper-available-height)\",\n            \"--radix-select-trigger-width\": \"var(--radix-popper-anchor-width)\",\n            \"--radix-select-trigger-height\":\n              \"var(--radix-popper-anchor-height)\",\n          } as any\n        }\n        {...props}\n      >\n        <Command\n          className={cn(\n            \"px-1 max-h-96 w-full min-w-[var(--radix-select-trigger-width)]\",\n            className\n          )}\n          shouldFilter={!context.onSearch}\n        >\n          {children}\n        </Command>\n      </PopoverPrimitive.Content>\n    </PopoverPrimitive.Portal>\n  )\n})\n\ntype MultiSelectItemProps = ComponentPropsWithoutRef<typeof CommandItem> &\n  Partial<MultiSelectOptionItem> & {\n    onSelect?: (value: string, item: MultiSelectOptionItem) => void\n    onDeselect?: (value: string, item: MultiSelectOptionItem) => void\n  }\n\nconst MultiSelectItem = React.forwardRef<\n  React.ElementRef<typeof CommandItem>,\n  MultiSelectItemProps\n>(\n  (\n    {\n      value,\n      onSelect: onSelectProp,\n      onDeselect: onDeselectProp,\n      children,\n      label,\n      disabled: disabledProp,\n      className,\n      ...props\n    },\n    forwardedRef\n  ) => {\n    const {\n      value: contextValue,\n      maxCount,\n      onSelect,\n      onDeselect,\n      itemCache,\n    } = useMultiSelect()\n\n    const item = React.useMemo(() => {\n      return value\n        ? {\n            value,\n            label:\n              label || (typeof children === \"string\" ? children : undefined),\n          }\n        : undefined\n    }, [value, label, children])\n\n    const selected = Boolean(value && contextValue.includes(value))\n\n    React.useEffect(() => {\n      if (value) {\n        itemCache.set(value, item!)\n      }\n    }, [selected, value, item])\n\n    const disabled = Boolean(\n      disabledProp || (!selected && maxCount && contextValue.length >= maxCount)\n    )\n\n    const handleClick = () => {\n      if (selected) {\n        onDeselectProp?.(value!, item!)\n        onDeselect(value!, item!)\n      } else {\n        itemCache.set(value!, item!)\n        onSelectProp?.(value!, item!)\n        onSelect(value!, item!)\n      }\n    }\n\n    return (\n      <CommandItem\n        {...props}\n        value={value}\n        className={cn(\n          disabled && \"text-muted-foreground cursor-not-allowed\",\n          className\n        )}\n        disabled={disabled}\n        onSelect={!disabled && value ? handleClick : undefined}\n        ref={forwardedRef}\n      >\n        <span className=\"mr-2 whitespace-nowrap overflow-hidden text-ellipsis\">\n          {children || label || value}\n        </span>\n        {selected ? <CheckIcon className=\"h-4 w-4 ml-auto shrink-0\" /> : null}\n      </CommandItem>\n    )\n  }\n)\n\nconst MultiSelectGroup = React.forwardRef<\n  React.ElementRef<typeof CommandGroup>,\n  ComponentPropsWithoutRef<typeof CommandGroup>\n>((props, forwardRef) => {\n  return <CommandGroup {...props} ref={forwardRef} />\n})\n\nMultiSelectGroup.displayName = \"MultiSelectGroup\"\n\nconst MultiSelectSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandSeparator>,\n  ComponentPropsWithoutRef<typeof CommandSeparator>\n>((props, forwardRef) => {\n  return <CommandSeparator {...props} ref={forwardRef} />\n})\n\nMultiSelectSeparator.displayName = \"MultiSelectSeparator\"\n\nconst MultiSelectEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandEmpty>,\n  ComponentPropsWithoutRef<typeof CommandEmpty>\n>(({ children = \"No Content\", ...props }, forwardRef) => {\n  return (\n    <CommandEmpty {...props} ref={forwardRef}>\n      {children}\n    </CommandEmpty>\n  )\n})\n\nMultiSelectEmpty.displayName = \"MultiSelectEmpty\"\n\nexport interface MultiSelectOptionSeparator {\n  type: \"separator\"\n}\n\nexport interface MultiSelectOptionGroup {\n  heading?: React.ReactNode\n  value?: string\n  children: MultiSelectOption[]\n}\n\nexport type MultiSelectOption =\n  | Pick<\n      MultiSelectItemProps,\n      \"value\" | \"label\" | \"disabled\" | \"onSelect\" | \"onDeselect\"\n    >\n  | MultiSelectOptionSeparator\n  | MultiSelectOptionGroup\n\nconst renderMultiSelectOptions = (list: MultiSelectOption[]) => {\n  return list.map((option, index) => {\n    if (\"type\" in option) {\n      if (option.type === \"separator\") {\n        return <MultiSelectSeparator key={index} />\n      }\n\n      return null\n    }\n\n    if (\"children\" in option) {\n      return (\n        <MultiSelectGroup\n          key={option.value || index}\n          value={option.value}\n          heading={option.heading}\n        >\n          {renderMultiSelectOptions(option.children)}\n        </MultiSelectGroup>\n      )\n    }\n\n    return (\n      <MultiSelectItem key={option.value} {...option}>\n        {option.label}\n      </MultiSelectItem>\n    )\n  })\n}\n\nexport {\n  MultiSelect,\n  MultiSelectTrigger,\n  MultiSelectValue,\n  MultiSelectSearch,\n  MultiSelectContent,\n  MultiSelectList,\n  MultiSelectItem,\n  MultiSelectGroup,\n  MultiSelectSeparator,\n  MultiSelectEmpty,\n  renderMultiSelectOptions,\n}\n"
    }
  ],
  "type": "components:ui"
}