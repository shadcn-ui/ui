{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "rule-builder",
  "type": "registry:ui",
  "registryDependencies": [
    "button",
    "select",
    "input",
    "radio-group",
    "label",
    "card",
    "separator"
  ],
  "files": [
    {
      "path": "registry/new-york-v4/ui/rule-builder.tsx",
      "content": "import * as React from \"react\"\nimport { GripVerticalIcon, MinusIcon, PlusIcon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/registry/new-york-v4/ui/button\"\nimport { Card, CardContent } from \"@/registry/new-york-v4/ui/card\"\nimport { Input } from \"@/registry/new-york-v4/ui/input\"\nimport { Label } from \"@/registry/new-york-v4/ui/label\"\nimport {\n  RadioGroup,\n  RadioGroupItem,\n} from \"@/registry/new-york-v4/ui/radio-group\"\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/registry/new-york-v4/ui/select\"\nimport { Separator } from \"@/registry/new-york-v4/ui/separator\"\n\n// Types\nexport type RuleField = {\n  id: string\n  name: string\n  type: \"number\" | \"string\" | \"select\" | \"tree\"\n  options?: { label: string; value: string }[]\n}\n\nexport type RuleOperator = {\n  id: string\n  name: string\n  symbol: string\n  supportedFieldTypes: RuleField[\"type\"][]\n}\n\nexport type RuleValue =\n  | string\n  | number\n  | { min: number; max: number }\n  | string[]\n\nexport type Rule = {\n  id: string\n  fieldId: string\n  operatorId: string\n  value: RuleValue\n}\n\nexport type RuleGroup = {\n  id: string\n  condition: \"and\" | \"or\"\n  rules: (Rule | RuleGroup)[]\n}\n\nexport type RuleBuilderProps = {\n  fields: RuleField[]\n  operators: RuleOperator[]\n  value: RuleGroup\n  onChange: (value: RuleGroup) => void\n  className?: string\n}\n\n// Default fields and operators for demo purposes\nexport const defaultRuleFields: RuleField[] = [\n  { id: \"age\", name: \"年龄\", type: \"number\" },\n  { id: \"city\", name: \"城市\", type: \"string\" },\n  { id: \"region\", name: \"地区\", type: \"tree\" },\n  { id: \"salary\", name: \"薪资\", type: \"number\" },\n  {\n    id: \"department\",\n    name: \"部门\",\n    type: \"select\",\n    options: [\n      { label: \"技术部\", value: \"tech\" },\n      { label: \"市场部\", value: \"marketing\" },\n      { label: \"财务部\", value: \"finance\" },\n    ],\n  },\n]\n\nexport const defaultRuleOperators: RuleOperator[] = [\n  {\n    id: \"equals\",\n    name: \"等于\",\n    symbol: \"=\",\n    supportedFieldTypes: [\"number\", \"string\", \"select\"],\n  },\n  {\n    id: \"notEquals\",\n    name: \"不等于\",\n    symbol: \"≠\",\n    supportedFieldTypes: [\"number\", \"string\", \"select\"],\n  },\n  {\n    id: \"greaterThan\",\n    name: \"大于\",\n    symbol: \">\",\n    supportedFieldTypes: [\"number\"],\n  },\n  {\n    id: \"lessThan\",\n    name: \"小于\",\n    symbol: \"<\",\n    supportedFieldTypes: [\"number\"],\n  },\n  {\n    id: \"greaterThanOrEqual\",\n    name: \"大于等于\",\n    symbol: \">=\",\n    supportedFieldTypes: [\"number\"],\n  },\n  {\n    id: \"lessThanOrEqual\",\n    name: \"小于等于\",\n    symbol: \"<=\",\n    supportedFieldTypes: [\"number\"],\n  },\n  {\n    id: \"between\",\n    name: \"区间\",\n    symbol: \"between\",\n    supportedFieldTypes: [\"number\"],\n  },\n  {\n    id: \"contains\",\n    name: \"包含\",\n    symbol: \"contains\",\n    supportedFieldTypes: [\"string\"],\n  },\n  {\n    id: \"notContains\",\n    name: \"不包含\",\n    symbol: \"not contains\",\n    supportedFieldTypes: [\"string\"],\n  },\n]\n\n// Helper functions\nconst generateId = () => Math.random().toString(36).substring(2, 9)\n\nconst getFieldById = (fields: RuleField[], id: string) =>\n  fields.find((f) => f.id === id)\nconst getOperatorById = (operators: RuleOperator[], id: string) =>\n  operators.find((o) => o.id === id)\n\n// Components\nfunction RuleGroupHeader({\n  condition,\n  onConditionChange,\n  onAddRule,\n  onAddGroup,\n  isRoot = false,\n}: {\n  condition: \"and\" | \"or\"\n  onConditionChange: (condition: \"and\" | \"or\") => void\n  onAddRule: () => void\n  onAddGroup: () => void\n  isRoot?: boolean\n}) {\n  return (\n    <div className=\"mb-4 flex items-center gap-3\">\n      {!isRoot && (\n        <div className=\"flex items-center gap-2\">\n          <GripVerticalIcon className=\"text-muted-foreground h-4 w-4 cursor-move\" />\n          <Label className=\"text-sm font-medium\">规则组</Label>\n        </div>\n      )}\n      <div className=\"flex items-center gap-2\">\n        <Label className=\"text-sm font-medium\">条件：</Label>\n        <RadioGroup\n          value={condition}\n          onValueChange={(value) => onConditionChange(value as \"and\" | \"or\")}\n          className=\"flex gap-4\"\n        >\n          <div className=\"flex items-center gap-1\">\n            <RadioGroupItem value=\"and\" id=\"and\" />\n            <Label htmlFor=\"and\">与</Label>\n          </div>\n          <div className=\"flex items-center gap-1\">\n            <RadioGroupItem value=\"or\" id=\"or\" />\n            <Label htmlFor=\"or\">或</Label>\n          </div>\n        </RadioGroup>\n      </div>\n      <div className=\"ml-auto flex gap-2\">\n        <Button variant=\"outline\" size=\"sm\" onClick={onAddRule}>\n          <PlusIcon className=\"mr-1 h-4 w-4\" />\n          添加规则\n        </Button>\n        <Button variant=\"outline\" size=\"sm\" onClick={onAddGroup}>\n          <PlusIcon className=\"mr-1 h-4 w-4\" />\n          添加组\n        </Button>\n      </div>\n    </div>\n  )\n}\n\nfunction RuleValueInput({\n  field,\n  operator,\n  value,\n  onChange,\n}: {\n  field?: RuleField\n  operator?: RuleOperator\n  value: RuleValue\n  onChange: (value: RuleValue) => void\n}) {\n  if (!field || !operator) {\n    return (\n      <Input placeholder=\"请选择字段和运算符\" disabled className=\"w-full\" />\n    )\n  }\n\n  // Handle number fields\n  if (field.type === \"number\") {\n    if (operator.id === \"between\") {\n      const { min, max } = (value as { min: number; max: number }) || {\n        min: 0,\n        max: 0,\n      }\n      return (\n        <div className=\"flex w-full gap-2\">\n          <Input\n            type=\"number\"\n            placeholder=\"最小值\"\n            value={min}\n            onChange={(e) => onChange({ min: Number(e.target.value), max })}\n            className=\"flex-1\"\n          />\n          <span className=\"flex items-center px-2\">至</span>\n          <Input\n            type=\"number\"\n            placeholder=\"最大值\"\n            value={max}\n            onChange={(e) => onChange({ min, max: Number(e.target.value) })}\n            className=\"flex-1\"\n          />\n        </div>\n      )\n    }\n    return (\n      <Input\n        type=\"number\"\n        placeholder=\"输入数值\"\n        value={value as number}\n        onChange={(e) => onChange(Number(e.target.value))}\n        className=\"w-full\"\n      />\n    )\n  }\n\n  // Handle select fields\n  if (field.type === \"select\" && field.options) {\n    return (\n      <Select value={value as string} onValueChange={(val) => onChange(val)}>\n        <SelectTrigger className=\"w-full\">\n          <SelectValue placeholder=\"选择选项\" />\n        </SelectTrigger>\n        <SelectContent>\n          {field.options.map((option) => (\n            <SelectItem key={option.value} value={option.value}>\n              {option.label}\n            </SelectItem>\n          ))}\n        </SelectContent>\n      </Select>\n    )\n  }\n\n  // Handle tree fields (simplified for demo)\n  if (field.type === \"tree\") {\n    return (\n      <Select value={value as string} onValueChange={(val) => onChange(val)}>\n        <SelectTrigger className=\"w-full\">\n          <SelectValue placeholder=\"选择地区\" />\n        </SelectTrigger>\n        <SelectContent>\n          <SelectItem value=\"beijing\">北京市</SelectItem>\n          <SelectItem value=\"shanghai\">上海市</SelectItem>\n          <SelectItem value=\"guangdong\">广东省</SelectItem>\n          <SelectItem value=\"jiangsu\">江苏省</SelectItem>\n        </SelectContent>\n      </Select>\n    )\n  }\n\n  // Default text input for string fields\n  return (\n    <Input\n      type=\"text\"\n      placeholder=\"输入文本\"\n      value={value as string}\n      onChange={(e) => onChange(e.target.value)}\n      className=\"w-full\"\n    />\n  )\n}\n\nfunction RuleItem({\n  rule,\n  index,\n  fields,\n  operators,\n  onUpdate,\n  onDelete,\n}: {\n  rule: Rule\n  index: number\n  fields: RuleField[]\n  operators: RuleOperator[]\n  onUpdate: (rule: Rule) => void\n  onDelete: () => void\n}) {\n  const field = getFieldById(fields, rule.fieldId)\n  const operator = getOperatorById(operators, rule.operatorId)\n  const supportedOperators = field\n    ? operators.filter((op) => op.supportedFieldTypes.includes(field.type))\n    : []\n\n  return (\n    <div className=\"flex items-center gap-2 py-2\">\n      <div className=\"flex min-w-0 flex-1 items-center gap-2\">\n        <div className=\"w-32 flex-shrink-0\">\n          <Select\n            value={rule.fieldId}\n            onValueChange={(value) => {\n              const newField = getFieldById(fields, value)\n              const defaultOperator = newField\n                ? operators.find((op) =>\n                    op.supportedFieldTypes.includes(newField.type)\n                  )?.id\n                : \"\"\n              onUpdate({\n                ...rule,\n                fieldId: value,\n                operatorId: defaultOperator || \"\",\n                value: newField?.type === \"number\" ? 0 : \"\",\n              })\n            }}\n          >\n            <SelectTrigger>\n              <SelectValue placeholder=\"选择字段\" />\n            </SelectTrigger>\n            <SelectContent>\n              {fields.map((field) => (\n                <SelectItem key={field.id} value={field.id}>\n                  {field.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n        <div className=\"w-32 flex-shrink-0\">\n          <Select\n            value={rule.operatorId}\n            onValueChange={(value) => {\n              const newOperator = getOperatorById(operators, value)\n              onUpdate({\n                ...rule,\n                operatorId: value,\n                value:\n                  newOperator?.id === \"between\"\n                    ? { min: 0, max: 0 }\n                    : field?.type === \"number\"\n                      ? 0\n                      : \"\",\n              })\n            }}\n            disabled={!rule.fieldId}\n          >\n            <SelectTrigger>\n              <SelectValue placeholder=\"选择运算符\" />\n            </SelectTrigger>\n            <SelectContent>\n              {supportedOperators.map((op) => (\n                <SelectItem key={op.id} value={op.id}>\n                  {op.symbol}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n        <div className=\"min-w-0 flex-1\">\n          <RuleValueInput\n            field={field}\n            operator={operator}\n            value={rule.value}\n            onChange={(value) => onUpdate({ ...rule, value })}\n          />\n        </div>\n      </div>\n      <Button variant=\"ghost\" size=\"icon-sm\" onClick={onDelete}>\n        <MinusIcon className=\"h-4 w-4\" />\n      </Button>\n    </div>\n  )\n}\n\nfunction RuleGroupComponent({\n  group,\n  fields,\n  operators,\n  onUpdate,\n  onDelete,\n  level = 0,\n}: {\n  group: RuleGroup\n  fields: RuleField[]\n  operators: RuleOperator[]\n  onUpdate: (group: RuleGroup) => void\n  onDelete: () => void\n  level?: number\n}) {\n  const isRoot = level === 0\n\n  const handleAddRule = () => {\n    const newRule: Rule = {\n      id: generateId(),\n      fieldId: \"\",\n      operatorId: \"\",\n      value: \"\",\n    }\n    onUpdate({\n      ...group,\n      rules: [...group.rules, newRule],\n    })\n  }\n\n  const handleAddGroup = () => {\n    const newGroup: RuleGroup = {\n      id: generateId(),\n      condition: \"and\",\n      rules: [],\n    }\n    onUpdate({\n      ...group,\n      rules: [...group.rules, newGroup],\n    })\n  }\n\n  const handleUpdateRule = (index: number, rule: Rule) => {\n    onUpdate({\n      ...group,\n      rules: group.rules.map((r, i) => (i === index ? rule : r)),\n    })\n  }\n\n  const handleDeleteRule = (index: number) => {\n    onUpdate({\n      ...group,\n      rules: group.rules.filter((_, i) => i !== index),\n    })\n  }\n\n  const handleUpdateGroup = (index: number, updatedGroup: RuleGroup) => {\n    onUpdate({\n      ...group,\n      rules: group.rules.map((r, i) => (i === index ? updatedGroup : r)),\n    })\n  }\n\n  const handleDeleteGroup = (index: number) => {\n    onUpdate({\n      ...group,\n      rules: group.rules.filter((_, i) => i !== index),\n    })\n  }\n\n  return (\n    <div className={cn(\"mb-3\", !isRoot && \"border-muted border-l-2 pl-6\")}>\n      <Card className={cn(!isRoot && \"shadow-sm\")}>\n        <CardContent className=\"p-4\">\n          <RuleGroupHeader\n            condition={group.condition}\n            onConditionChange={(condition) => onUpdate({ ...group, condition })}\n            onAddRule={handleAddRule}\n            onAddGroup={handleAddGroup}\n            isRoot={isRoot}\n          />\n\n          {group.rules.length === 0 ? (\n            <div className=\"text-muted-foreground py-4 text-center\">\n              暂无规则，点击&quot;添加规则&quot;或&quot;添加组&quot;开始创建\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {group.rules.map((item, index) => (\n                <div key={item.id} className=\"relative\">\n                  {index > 0 && (\n                    <div className=\"bg-muted absolute top-1/2 right-0 left-0 -z-10 h-px\" />\n                  )}\n                  {index > 0 && (\n                    <div className=\"mb-2 flex justify-center\">\n                      <span className=\"bg-background text-muted-foreground rounded-full px-2 text-xs\">\n                        {group.condition === \"and\" ? \"并且\" : \"或者\"}\n                      </span>\n                    </div>\n                  )}\n\n                  {\"condition\" in item ? (\n                    <RuleGroupComponent\n                      group={item}\n                      fields={fields}\n                      operators={operators}\n                      onUpdate={(updatedGroup) =>\n                        handleUpdateGroup(index, updatedGroup)\n                      }\n                      onDelete={() => handleDeleteGroup(index)}\n                      level={level + 1}\n                    />\n                  ) : (\n                    <RuleItem\n                      rule={item}\n                      index={index}\n                      fields={fields}\n                      operators={operators}\n                      onUpdate={(updatedRule) =>\n                        handleUpdateRule(index, updatedRule)\n                      }\n                      onDelete={() => handleDeleteRule(index)}\n                    />\n                  )}\n                </div>\n              ))}\n            </div>\n          )}\n\n          {!isRoot && (\n            <div className=\"mt-4 flex justify-end\">\n              <Button variant=\"destructive\" size=\"sm\" onClick={onDelete}>\n                <MinusIcon className=\"mr-1 h-4 w-4\" />\n                删除组\n              </Button>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n\nexport function RuleBuilder({\n  fields,\n  operators,\n  value,\n  onChange,\n  className,\n}: RuleBuilderProps) {\n  return (\n    <div className={cn(\"space-y-4\", className)}>\n      <RuleGroupComponent\n        group={value}\n        fields={fields}\n        operators={operators}\n        onUpdate={onChange}\n        onDelete={() => {}}\n        level={0}\n      />\n    </div>\n  )\n}\n\nRuleBuilder.displayName = \"RuleBuilder\"\n",
      "type": "registry:ui"
    }
  ]
}