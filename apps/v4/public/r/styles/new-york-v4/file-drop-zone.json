{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "file-drop-zone",
  "type": "registry:ui",
  "dependencies": [
    "lucide-react"
  ],
  "registryDependencies": [
    "progress"
  ],
  "files": [
    {
      "path": "registry/new-york-v4/ui/file-drop-zone.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport {\n  File,\n  FileAudio,\n  FileImage,\n  FileText,\n  FileVideo,\n  Loader2,\n  Upload,\n  X,\n} from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Progress } from \"@/registry/new-york-v4/ui/progress\"\n\n// -----------------------------------------------------------------------------\n// Types\n// -----------------------------------------------------------------------------\n\nexport type FileStatus = \"pending\" | \"uploading\" | \"complete\" | \"error\"\n\nexport interface FileWithMeta {\n  id: string\n  file: File\n  status: FileStatus\n  progress: number\n  error?: string\n  thumbnail?: string\n}\n\ntype FileDropZoneContextValue = {\n  files: FileWithMeta[]\n  disabled: boolean\n  multiple: boolean\n  maxFiles: number\n  maxSize: number\n  accept?: string\n  isDragActive: boolean\n  isInvalid: boolean\n  addFiles: (files: File[]) => void\n  removeFile: (id: string) => void\n  openFileBrowser: () => void\n  inputRef: React.RefObject<HTMLInputElement | null>\n}\n\nconst FileDropZoneContext =\n  React.createContext<FileDropZoneContextValue | null>(null)\n\nfunction useFileDropZone() {\n  const context = React.useContext(FileDropZoneContext)\n  if (!context) {\n    throw new Error(\"useFileDropZone must be used within a <FileDropZone />\")\n  }\n  return context\n}\n\n// -----------------------------------------------------------------------------\n// Utilities\n// -----------------------------------------------------------------------------\n\nfunction generateId(): string {\n  return Math.random().toString(36).substring(2, 9)\n}\n\nfunction FileTypeIcon({ file, className }: { file: File; className?: string }) {\n  const type = file.type\n\n  if (type.startsWith(\"image/\")) {\n    return <FileImage className={className} />\n  }\n  if (type.startsWith(\"video/\")) {\n    return <FileVideo className={className} />\n  }\n  if (type.startsWith(\"audio/\")) {\n    return <FileAudio className={className} />\n  }\n  if (\n    type.startsWith(\"text/\") ||\n    type === \"application/pdf\" ||\n    type === \"application/msword\" ||\n    type.includes(\"document\") ||\n    type.includes(\"spreadsheet\") ||\n    type.includes(\"presentation\")\n  ) {\n    return <FileText className={className} />\n  }\n\n  return <File className={className} />\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) return \"0 B\"\n  const k = 1024\n  const sizes = [\"B\", \"KB\", \"MB\", \"GB\"]\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`\n}\n\nfunction validateFile(\n  file: File,\n  accept?: string,\n  maxSize?: number\n): string | null {\n  if (maxSize && file.size > maxSize) {\n    return `File size exceeds ${formatFileSize(maxSize)}`\n  }\n\n  if (accept) {\n    const acceptedTypes = accept.split(\",\").map((t) => t.trim().toLowerCase())\n    const fileType = file.type.toLowerCase()\n    const fileExtension = `.${file.name.split(\".\").pop()?.toLowerCase()}`\n\n    const isAccepted = acceptedTypes.some((accepted) => {\n      if (accepted.startsWith(\".\")) {\n        return fileExtension === accepted\n      }\n      if (accepted.endsWith(\"/*\")) {\n        return fileType.startsWith(accepted.replace(\"/*\", \"/\"))\n      }\n      return fileType === accepted\n    })\n\n    if (!isAccepted) {\n      return \"File type not accepted\"\n    }\n  }\n\n  return null\n}\n\n// -----------------------------------------------------------------------------\n// FileDropZone (Root)\n// -----------------------------------------------------------------------------\n\nexport interface FileDropZoneProps\n  extends Omit<React.ComponentProps<\"div\">, \"onChange\"> {\n  files?: FileWithMeta[]\n  onFilesChange?: (files: FileWithMeta[]) => void\n  disabled?: boolean\n  multiple?: boolean\n  maxFiles?: number\n  maxSize?: number\n  accept?: string\n  \"aria-invalid\"?: boolean\n}\n\nfunction FileDropZone({\n  className,\n  children,\n  files: controlledFiles,\n  onFilesChange,\n  disabled = false,\n  multiple = true,\n  maxFiles = Infinity,\n  maxSize = Infinity,\n  accept,\n  \"aria-invalid\": ariaInvalid,\n  ...props\n}: FileDropZoneProps) {\n  const [internalFiles, setInternalFiles] = React.useState<FileWithMeta[]>([])\n  const [isDragActive, setIsDragActive] = React.useState(false)\n  const inputRef = React.useRef<HTMLInputElement>(null)\n\n  const isControlled = controlledFiles !== undefined\n  const files = isControlled ? controlledFiles : internalFiles\n  const isInvalid = ariaInvalid === true\n\n  const updateFiles = React.useCallback(\n    (newFiles: FileWithMeta[]) => {\n      if (!isControlled) {\n        setInternalFiles(newFiles)\n      }\n      onFilesChange?.(newFiles)\n    },\n    [isControlled, onFilesChange]\n  )\n\n  const addFiles = React.useCallback(\n    (newFiles: File[]) => {\n      if (disabled) return\n\n      const availableSlots = multiple ? maxFiles - files.length : 1\n      const filesToAdd = newFiles.slice(0, availableSlots)\n\n      const newFileItems: FileWithMeta[] = filesToAdd.map((file) => {\n        const validationError = validateFile(file, accept, maxSize)\n        return {\n          id: generateId(),\n          file,\n          status: validationError ? \"error\" : \"pending\",\n          progress: 0,\n          error: validationError ?? undefined,\n        }\n      })\n\n      if (multiple) {\n        updateFiles([...files, ...newFileItems])\n      } else {\n        updateFiles(newFileItems)\n      }\n    },\n    [disabled, multiple, maxFiles, files, accept, maxSize, updateFiles]\n  )\n\n  const removeFile = React.useCallback(\n    (id: string) => {\n      if (disabled) return\n      updateFiles(files.filter((f) => f.id !== id))\n    },\n    [disabled, files, updateFiles]\n  )\n\n  const openFileBrowser = React.useCallback(() => {\n    if (disabled) return\n    inputRef.current?.click()\n  }, [disabled])\n\n  const handleDragEnter = React.useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!disabled) {\n        setIsDragActive(true)\n      }\n    },\n    [disabled]\n  )\n\n  const handleDragLeave = React.useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    if (e.currentTarget === e.target) {\n      setIsDragActive(false)\n    }\n  }, [])\n\n  const handleDragOver = React.useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault()\n      e.stopPropagation()\n      if (!disabled) {\n        setIsDragActive(true)\n      }\n    },\n    [disabled]\n  )\n\n  const handleDrop = React.useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault()\n      e.stopPropagation()\n      setIsDragActive(false)\n\n      if (disabled) return\n\n      const droppedFiles = Array.from(e.dataTransfer.files)\n      if (droppedFiles.length > 0) {\n        addFiles(droppedFiles)\n      }\n    },\n    [disabled, addFiles]\n  )\n\n  const handleInputChange = React.useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      const selectedFiles = Array.from(e.target.files || [])\n      if (selectedFiles.length > 0) {\n        addFiles(selectedFiles)\n      }\n      // Reset input value to allow selecting the same file again\n      e.target.value = \"\"\n    },\n    [addFiles]\n  )\n\n  const contextValue = React.useMemo<FileDropZoneContextValue>(\n    () => ({\n      files,\n      disabled,\n      multiple,\n      maxFiles,\n      maxSize,\n      accept,\n      isDragActive,\n      isInvalid,\n      addFiles,\n      removeFile,\n      openFileBrowser,\n      inputRef,\n    }),\n    [\n      files,\n      disabled,\n      multiple,\n      maxFiles,\n      maxSize,\n      accept,\n      isDragActive,\n      isInvalid,\n      addFiles,\n      removeFile,\n      openFileBrowser,\n    ]\n  )\n\n  return (\n    <FileDropZoneContext.Provider value={contextValue}>\n      <div\n        data-slot=\"file-drop-zone\"\n        data-disabled={disabled || undefined}\n        data-dragging={isDragActive || undefined}\n        className={cn(\"flex w-full flex-col gap-4\", className)}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n        {...props}\n      >\n        <input\n          ref={inputRef}\n          type=\"file\"\n          className=\"sr-only\"\n          accept={accept}\n          multiple={multiple}\n          disabled={disabled}\n          onChange={handleInputChange}\n          tabIndex={-1}\n        />\n        {children}\n      </div>\n    </FileDropZoneContext.Provider>\n  )\n}\n\n// -----------------------------------------------------------------------------\n// FileDropZoneArea\n// -----------------------------------------------------------------------------\n\nconst fileDropZoneAreaVariants = cva(\n  [\n    \"relative flex min-h-40 cursor-pointer flex-col items-center justify-center gap-4 rounded-lg border-2 border-dashed p-6 text-center transition-all\",\n    \"outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]\",\n    \"data-[invalid=true]:border-destructive data-[invalid=true]:ring-destructive/20 dark:data-[invalid=true]:ring-destructive/40\",\n  ],\n  {\n    variants: {\n      variant: {\n        default: [\n          \"border-input bg-background hover:border-ring hover:bg-accent/50\",\n          \"data-[dragging=true]:border-primary data-[dragging=true]:bg-primary/5\",\n        ],\n        ghost: [\n          \"border-transparent bg-muted/50 hover:bg-muted\",\n          \"data-[dragging=true]:border-primary data-[dragging=true]:bg-primary/5\",\n        ],\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface FileDropZoneAreaProps\n  extends React.ComponentProps<\"div\">,\n    VariantProps<typeof fileDropZoneAreaVariants> {}\n\nfunction FileDropZoneArea({\n  className,\n  variant,\n  children,\n  ...props\n}: FileDropZoneAreaProps) {\n  const { disabled, isDragActive, isInvalid, openFileBrowser } =\n    useFileDropZone()\n\n  const handleKeyDown = React.useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === \"Enter\" || e.key === \" \") {\n        e.preventDefault()\n        openFileBrowser()\n      }\n    },\n    [openFileBrowser]\n  )\n\n  return (\n    <div\n      data-slot=\"file-drop-zone-area\"\n      data-dragging={isDragActive || undefined}\n      data-invalid={isInvalid || undefined}\n      role=\"button\"\n      tabIndex={disabled ? -1 : 0}\n      aria-disabled={disabled || undefined}\n      onClick={disabled ? undefined : openFileBrowser}\n      onKeyDown={disabled ? undefined : handleKeyDown}\n      className={cn(\n        fileDropZoneAreaVariants({ variant }),\n        disabled && \"pointer-events-none opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n}\n\n// -----------------------------------------------------------------------------\n// FileDropZoneContent\n// -----------------------------------------------------------------------------\n\nfunction FileDropZoneContent({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  const { isDragActive, multiple, disabled } = useFileDropZone()\n\n  return (\n    <div\n      data-slot=\"file-drop-zone-content\"\n      className={cn(\n        \"flex flex-col items-center gap-2 text-center\",\n        disabled && \"opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      {children ?? (\n        <>\n          <div className=\"bg-muted flex size-12 items-center justify-center rounded-full\">\n            <Upload className=\"text-muted-foreground size-6\" />\n          </div>\n          <div className=\"flex flex-col gap-1\">\n            <p className=\"text-sm font-medium\">\n              {isDragActive\n                ? \"Drop files here\"\n                : `Drag & drop ${multiple ? \"files\" : \"a file\"} here`}\n            </p>\n            <p className=\"text-muted-foreground text-xs\">or click to browse</p>\n          </div>\n        </>\n      )}\n    </div>\n  )\n}\n\n// -----------------------------------------------------------------------------\n// FileDropZoneList\n// -----------------------------------------------------------------------------\n\nfunction FileDropZoneList({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  const { files } = useFileDropZone()\n\n  if (files.length === 0 && !children) {\n    return null\n  }\n\n  return (\n    <div\n      data-slot=\"file-drop-zone-list\"\n      role=\"list\"\n      className={cn(\"flex flex-col gap-2\", className)}\n      {...props}\n    >\n      {children ??\n        files.map((file) => <FileDropZoneItem key={file.id} file={file} />)}\n    </div>\n  )\n}\n\n// -----------------------------------------------------------------------------\n// FileDropZoneItem\n// -----------------------------------------------------------------------------\n\nconst fileDropZoneItemVariants = cva(\n  \"group/item relative flex items-center gap-3 rounded-lg border p-3 transition-all animate-in fade-in-0 slide-in-from-bottom-2 duration-200\",\n  {\n    variants: {\n      status: {\n        pending: \"border-input bg-background\",\n        uploading: \"border-input bg-background\",\n        complete: \"border-input bg-background\",\n        error: \"border-destructive/50 bg-destructive/5\",\n      },\n    },\n    defaultVariants: {\n      status: \"pending\",\n    },\n  }\n)\n\nexport interface FileDropZoneItemProps extends React.ComponentProps<\"div\"> {\n  file: FileWithMeta\n  onRemove?: (id: string) => void\n}\n\nfunction FileDropZoneItem({\n  className,\n  file,\n  onRemove,\n  ...props\n}: FileDropZoneItemProps) {\n  const { removeFile, disabled } = useFileDropZone()\n\n  const handleRemove = React.useCallback(\n    (e: React.MouseEvent) => {\n      e.stopPropagation()\n      if (onRemove) {\n        onRemove(file.id)\n      } else {\n        removeFile(file.id)\n      }\n    },\n    [file.id, onRemove, removeFile]\n  )\n\n  const handleKeyDown = React.useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === \"Delete\" || e.key === \"Backspace\") {\n        e.preventDefault()\n        if (onRemove) {\n          onRemove(file.id)\n        } else {\n          removeFile(file.id)\n        }\n      }\n    },\n    [file.id, onRemove, removeFile]\n  )\n\n  return (\n    <div\n      data-slot=\"file-drop-zone-item\"\n      data-status={file.status}\n      role=\"listitem\"\n      tabIndex={disabled ? -1 : 0}\n      onKeyDown={disabled ? undefined : handleKeyDown}\n      className={cn(\n        fileDropZoneItemVariants({ status: file.status }),\n        \"focus-visible:border-ring focus-visible:ring-ring/50 outline-none focus-visible:ring-[3px]\",\n        disabled && \"pointer-events-none opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      {/* Thumbnail or Icon */}\n      <div className=\"bg-muted relative flex size-10 shrink-0 items-center justify-center overflow-hidden rounded-md\">\n        {file.thumbnail ? (\n          <img src={file.thumbnail} alt=\"\" className=\"size-full object-cover\" />\n        ) : (\n          <FileTypeIcon\n            file={file.file}\n            className=\"text-muted-foreground size-5\"\n          />\n        )}\n\n        {/* Spinner overlay when uploading */}\n        {file.status === \"uploading\" && (\n          <div className=\"bg-background/80 absolute inset-0 flex items-center justify-center\">\n            <Loader2 className=\"text-primary size-5 animate-spin\" />\n          </div>\n        )}\n      </div>\n\n      {/* File info */}\n      <div className=\"flex min-w-0 flex-1 flex-col gap-1\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"truncate text-sm font-medium\">{file.file.name}</span>\n          {file.status === \"complete\" && (\n            <span className=\"text-xs text-green-600 dark:text-green-500\">\n              Complete\n            </span>\n          )}\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-muted-foreground text-xs\">\n            {formatFileSize(file.file.size)}\n          </span>\n          {file.error && (\n            <span className=\"text-destructive text-xs\">{file.error}</span>\n          )}\n        </div>\n\n        {/* Progress bar */}\n        {file.status === \"uploading\" && (\n          <Progress value={file.progress} className=\"mt-1 h-1\" />\n        )}\n      </div>\n\n      {/* Remove button */}\n      <button\n        type=\"button\"\n        onClick={handleRemove}\n        disabled={disabled}\n        className={cn(\n          \"flex size-6 shrink-0 items-center justify-center rounded-md opacity-0 transition-opacity\",\n          \"hover:bg-muted group-hover/item:opacity-100 focus-visible:opacity-100\",\n          \"focus-visible:ring-ring/50 outline-none focus-visible:ring-[3px]\",\n          \"disabled:pointer-events-none disabled:opacity-50\"\n        )}\n        aria-label={`Remove ${file.file.name}`}\n      >\n        <X className=\"size-4\" />\n      </button>\n    </div>\n  )\n}\n\n// -----------------------------------------------------------------------------\n// FileDropZoneError\n// -----------------------------------------------------------------------------\n\nexport interface FileDropZoneErrorProps extends React.ComponentProps<\"div\"> {\n  errors?: Array<{ message?: string } | undefined>\n}\n\nfunction FileDropZoneError({\n  className,\n  children,\n  errors,\n  ...props\n}: FileDropZoneErrorProps) {\n  const content = React.useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors?.length) {\n      return null\n    }\n\n    const uniqueErrors = [\n      ...new Map(errors.map((error) => [error?.message, error])).values(),\n    ]\n\n    if (uniqueErrors?.length === 1) {\n      return uniqueErrors[0]?.message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {uniqueErrors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"file-drop-zone-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\n// -----------------------------------------------------------------------------\n// Exports\n// -----------------------------------------------------------------------------\n\nexport {\n  FileDropZone,\n  FileDropZoneArea,\n  FileDropZoneContent,\n  FileDropZoneList,\n  FileDropZoneItem,\n  FileDropZoneError,\n  useFileDropZone,\n}\n",
      "type": "registry:ui"
    }
  ],
  "tailwind": {
    "config": {
      "theme": {
        "extend": {
          "keyframes": {
            "fade-in": {
              "from": {
                "opacity": "0"
              },
              "to": {
                "opacity": "1"
              }
            },
            "slide-in-from-bottom": {
              "from": {
                "transform": "translateY(0.5rem)"
              },
              "to": {
                "transform": "translateY(0)"
              }
            }
          },
          "animation": {
            "fade-in": "fade-in 0.2s ease-out",
            "slide-in-from-bottom": "slide-in-from-bottom 0.2s ease-out"
          }
        }
      }
    }
  }
}